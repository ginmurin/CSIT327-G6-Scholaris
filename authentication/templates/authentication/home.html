{% load static %}
{% load app_filters %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=1200, initial-scale=1.0, user-scalable=no">
  <title>Dashboard - Learning Pathway</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <link rel="stylesheet" href="{% static 'authentication/css/home.css' %}?v=104">
  <script>
    window.addEventListener('pageshow', function (e) {
      if (e.persisted) location.reload();
    });
  </script>
</head>
<body>
  <div class="dashboard-container">
    <header class="dashboard-header">
      <div class="welcome-section">
        <div class="profile-avatar">
          {% if user.profile_picture %}
            {% if user.profile_picture.url %}
              <img src="{{ user.profile_picture.url }}" alt="{{ user.name }}" class="avatar-img">
            {% else %}
              <img src="{{ user.profile_picture }}" alt="{{ user.name }}" class="avatar-img">
            {% endif %}
          {% else %}
            <div class="avatar-placeholder">{{ user.name|first|upper }}</div>
          {% endif %}
        </div>
        <div class="welcome-text">
          <h1>Welcome back, {{ name }}!</h1>
          <p>Ready to continue your journey?</p>
        </div>
      </div>

      <div class="header-actions">
        <a href="{% url 'profile' %}" class="btn btn-settings">
          Settings
        </a>

        {% if is_admin %}
          <a href="/panel/home/" class="btn btn-admin-switch">
            Admin View
          </a>
        {% endif %}
      </div>
    </header>

    <div class="quick-stats">
      <div class="stat-card">
        <span class="stat-icon">ğŸ“š</span>
        <div class="stat-value">{{ study_plan_count }}</div>
        <div class="stat-label">Study Plans</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">â­</span>
        <div class="stat-value">{{ user.total_points }}</div>
        <div class="stat-label">Points</div>
      </div>

      <a href="{% url 'leaderboard' %}" style="text-decoration:none; color:inherit;">
        <div class="stat-card" style="cursor:pointer;">
          <span class="stat-icon">ğŸ†</span>
          <div class="stat-value">#{{ user_rank }}</div>
          <div class="stat-label">Ranking</div>
        </div>
      </a>
    </div>

    {% if study_plans %}
    <div class="study-plans-section">
      <div class="section-header">
        <h2>My Study Plans</h2>
        <a href="{% url 'list_study_plans' %}" class="view-all-link">View All â†’</a>
      </div>
      
      <div class="study-plans-grid">
        {% for plan in study_plans %}
        <div class="study-plan-card">
          <div class="plan-header">
            <h3 class="plan-title">{{ plan.title }}</h3>
            <span class="plan-badge">Active</span>
          </div>
          
          <p class="plan-objective">{{ plan.learning_objective|truncatewords:15 }}</p>
          
          <div class="plan-details">
            <div class="plan-detail-item">
              <span class="detail-icon">ğŸ“…</span>
              <span class="detail-text">{{ plan.start_date|date:"M d" }} - {{ plan.end_date|date:"M d" }}</span>
            </div>
            <div class="plan-detail-item">
              <span class="detail-icon">â°</span>
              <span class="detail-text">{{ plan.estimated_hours_per_week }}h/week</span>
            </div>
          </div>
          
          <div class="plan-actions-home">
            <a href="{% url 'study_plan_progress' plan.id %}" class="plan-btn btn-resources-home">
              <span class="btn-icon"></span>
              <span>Progress</span>
            </a>
            <a href="{% url 'edit_study_plan' plan.id %}" class="plan-btn btn-edit-home">
              <span class="btn-icon">âœï¸</span>
              <span>Edit</span>
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="action-cards">
      <a href="{% url 'create_study_plan' %}" class="action-card card-primary">
        <span class="card-icon">â•</span>
        <h3 class="card-title">Create New Plan</h3>
        <p class="card-description">Design a custom study plan tailored to your learning goals and schedule</p>
      </a>
      
      <a href="{% url 'list_study_plans' %}" class="action-card">
        <span class="card-icon">ğŸ“–</span>
        <h3 class="card-title">My Study Plans</h3>
        <p class="card-description">View, edit, and manage all your personalized study plans in one place</p>
      </a>
      
      <a href="{% url 'logout' %}" class="action-card card-logout">
        <span class="card-icon">ğŸšª</span>
        <h3 class="card-title">Sign Out</h3>
        <p class="card-description">Safely log out of your account when you're done</p>
      </a>
    </div>
  </div>
</body>
</html>
