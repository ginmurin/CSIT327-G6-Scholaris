{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Learning Pathway</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <link rel="stylesheet" href="{% static 'authentication/css/home.css' %}?v=100">
  <script>
    // If user presses Back and the page was BF-cached, force a reload
    window.addEventListener('pageshow', function (e) {
      if (e.persisted) location.reload();
    });
  </script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="welcome-section">
        <div class="profile-avatar">
          {% if user.profile_picture %}
            <img src="{{ user.profile_picture }}" alt="{{ user.name }}" class="avatar-img">
          {% else %}
            <div class="avatar-placeholder">{{ user.name|first|upper }}</div>
          {% endif %}
        </div>
        <div class="welcome-text">
          <h1>Welcome back, {{ name }}! 🎓</h1>
          <p>{{ user.learningstyle }} Learner - Ready to continue your journey?</p>
        </div>
      </div>
      <div class="header-actions">
        <a href="{% url 'profile' %}" class="btn btn-profile">
          👤 Profile
        </a>
        <a href="{% url 'create_study_plan' %}" class="btn btn-primary">
          ✨ Create Study Plan
        </a>
        <a href="{% url 'logout' %}" class="btn btn-secondary">
          Logout
        </a>
      </div>
    </header>

    <!-- Quick Stats -->
    <div class="quick-stats">
      <div class="stat-card">
        <span class="stat-icon">📚</span>
        <div class="stat-value">{{ study_plan_count }}</div>
        <div class="stat-label">Study Plans</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">🎯</span>
        <div class="stat-value">0</div>
        <div class="stat-label">Goals Achieved</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">⏱️</span>
        <div class="stat-value">0h</div>
        <div class="stat-label">Study Time</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">🔥</span>
        <div class="stat-value">0</div>
        <div class="stat-label">Day Streak</div>
      </div>
    </div>

    <!-- My Study Plans Section -->
    {% if study_plans %}
    <div class="study-plans-section">
      <div class="section-header">
        <h2>📚 My Active Study Plans</h2>
        <a href="{% url 'list_study_plans' %}" class="view-all-link">View All →</a>
      </div>
      
      <div class="study-plans-grid">
        {% for plan in study_plans %}
        <div class="study-plan-card">
          <div class="plan-header">
            <h3 class="plan-title">{{ plan.title }}</h3>
            <span class="plan-badge">Active</span>
          </div>
          
          <p class="plan-objective">{{ plan.learning_objective|truncatewords:15 }}</p>
          
          <div class="plan-details">
            <div class="plan-detail-item">
              <span class="detail-icon">📅</span>
              <span class="detail-text">{{ plan.start_date|date:"M d" }} - {{ plan.end_date|date:"M d" }}</span>
            </div>
            <div class="plan-detail-item">
              <span class="detail-icon">⏰</span>
              <span class="detail-text">{{ plan.estimated_hours_per_week }}h/week</span>
            </div>
          </div>
          
          <div class="plan-actions-home">
            <a href="{% url 'study_plan_progress' plan.id %}" class="plan-btn btn-resources-home">
              <span class="btn-icon">�</span>
              <span>Progress</span>
            </a>
            <a href="{% url 'edit_study_plan' plan.id %}" class="plan-btn btn-edit-home">
              <span class="btn-icon">✏️</span>
              <span>Edit</span>
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if recommendations %}
    <!-- AI-Powered Recommendations -->
    <div class="ai-recommendations">
      <div class="ai-header">
        <h2>🤖 Your Personalized Learning Plan</h2>
        <p>AI-powered recommendations based on your {{ user.learningstyle }} learning style</p>
      </div>

      <div class="recommendations-grid">
        <!-- Study Techniques -->
        <div class="recommendation-card">
          <h3>📝 Recommended Study Techniques</h3>
          <ul class="technique-list">
            {% for technique in recommendations.study_techniques %}
              <li>{{ technique }}</li>
            {% endfor %}
          </ul>
        </div>

        <!-- Resources - PROMINENT SECTION -->
        <div class="recommendation-card card-resources-featured">
          <h3>📚 Curated Learning Resources</h3>
          <p class="resources-subtitle">Click to start learning instantly!</p>
          <div class="resources-list-featured">
            {% for resource in recommendations.recommended_resources %}
              <a href="{{ resource.url|default:'#' }}" target="_blank" class="resource-card-clickable">
                <div class="resource-card-content">
                  <div class="resource-card-header-inline">
                    <span class="resource-badge-large badge-{{ resource.type }}">
                      {% if resource.type == "video" %}📺 Video
                      {% elif resource.type == "article" %}📄 Article
                      {% elif resource.type == "practice" %}🎯 Practice
                      {% else %}📖 {{ resource.type|title }}
                      {% endif %}
                    </span>
                    {% if resource.platform %}
                      <span class="resource-platform-large">{{ resource.platform }}</span>
                    {% endif %}
                  </div>
                  <h4 class="resource-title-large">{{ resource.title }}</h4>
                  <p class="resource-desc-large">{{ resource.description|truncatewords:15 }}</p>
                  <div class="resource-cta-bar">
                    <span class="cta-text">Open Resource</span>
                    <span class="cta-arrow">→</span>
                  </div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>

        <!-- Time Allocation -->
        <div class="recommendation-card">
          <h3>⏰ Suggested Study Schedule</h3>
          <div class="time-allocation">
            <div class="time-main">
              <span class="time-value">{{ recommendations.time_allocation.daily_minutes }}</span>
              <span class="time-label">minutes/day</span>
            </div>
            <div class="time-breakdown">
              <div class="breakdown-item">
                <span class="breakdown-label">Theory:</span>
                <span class="breakdown-value">{{ recommendations.time_allocation.breakdown.theory }}%</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">Practice:</span>
                <span class="breakdown-value">{{ recommendations.time_allocation.breakdown.practice }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Milestones -->
        <div class="recommendation-card">
          <h3>🎯 Learning Milestones</h3>
          <ul class="milestone-list">
            {% for milestone in recommendations.milestones %}
              <li><span class="milestone-icon">✓</span> {{ milestone }}</li>
            {% endfor %}
          </ul>
        </div>

        <!-- Tips -->
        <div class="recommendation-card card-highlight">
          <h3>💡 Pro Tips for {{ user.learningstyle }} Learners</h3>
          <ul class="tips-list">
            {% for tip in recommendations.tips %}
              <li>{{ tip }}</li>
            {% endfor %}
          </ul>
        </div>

        <!-- User Goals -->
        <div class="recommendation-card card-goals">
          <h3>🎯 Your Learning Goals</h3>
          <p class="goals-text">{{ user.goals }}</p>
          <div class="goals-action">
            <span class="goals-reminder">Keep these in mind as you create study plans!</span>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Action Cards -->
    <div class="action-cards">
      <a href="{% url 'list_study_plans' %}" class="action-card card-primary">
        <span class="card-icon">📖</span>
        <h3 class="card-title">My Study Plans</h3>
        <p class="card-description">View, edit, and manage all your personalized study plans in one place</p>
      </a>
      
      <a href="{% url 'create_study_plan' %}" class="action-card">
        <span class="card-icon">➕</span>
        <h3 class="card-title">Create New Plan</h3>
        <p class="card-description">Design a custom study plan tailored to your learning goals and schedule</p>
      </a>
      
      <a href="{% url 'logout' %}" class="action-card card-logout">
        <span class="card-icon">🚪</span>
        <h3 class="card-title">Sign Out</h3>
        <p class="card-description">Safely log out of your account when you're done</p>
      </a>
    </div>
  </div>
</body>
</html>